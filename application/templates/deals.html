{% extends "base_no_turbo.html" %}

{% block main_content %}
<body class="deals_body" style="overflow-x: hidden;">
    <nav class="navbar navbar-expand-lg navbar-light bg-ubuntu">
        <a class="navbar-brand text-white" href="#">SHERPA</a>
        <button class="navbar-toggler" type="button" data-target="#navbarNav" data-toggle="collapse"  aria-label="Toggle navigation" aria-controls="navbarNav" aria-expanded="false">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link text-white" href="{{ url_for('home') }}">Home</a>
            </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="{{ url_for('contacts_bp.contacts') }}">Contacts</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href ="{{url_for('deals_bp.deals')}}">Deals</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="{{ url_for('teams.team') }}">Team</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="#">Profile</a>
          <li class="nav-item">
            <a  class="nav-link text-white" onclick="logout();" href="{{ url_for('auth.profile') }}">Logout</a>
          </li>
        </ul>
      </div>
    </nav>
        <h1>
            Deals
        </h1>
        <section id="deals">
            <div class="row">
            <div class="col-md-2">
                <section id="deals_filter_buttons">
                    <div class="list-group">
                        <a href = "{{url_for('deals_bp.deals', prev_sort='None', order='ASC', sort='None', filter='all', page=1 , error='None')}}"class="list-group-item mb-2">All Deals</a>
                        <a href = "{{url_for('deals_bp.deals', prev_sort='None', order='ASC', sort='None', filter='assigned', page=1 , error='None')}}"class="list-group-item mb-2">Assigned Deals</a>
                    </div>
                </section>
            </div>
        <div class="col-md-10">
            <table class="table table-bordered table-striped table-responsive">
                <form action = "" method = "POST" novalidate></form>
                {{search_form.hidden_tag()}}
                    <tr>
                        <td>{{search_form.search_bar}}</td>
                        <td>{{search_form.submit(id="deals_search_button")}}</td>
                    </tr>
                </form>
            {% set prev_sort = sort %}
            <thead class="thead-dark"></thead>
            <tr class="table-dark">
                <th><a href="{{url_for('deals_bp.deals', prev_sort=prev_sort, order=order, sort='name', page=page, filter=filter, error='None')}}">Deal Name</a></th>
                <th><a href="{{url_for('deals_bp.deals', prev_sort=prev_sort, order=order, sort='stage', page=page, filter=filter, error='None')}}">Deal Stage</a></th>
                <th><a href="{{url_for('deals_bp.deals', prev_sort=prev_sort, order=order, sort='close_date', page=page, filter=filter, error='None')}}">Close Date</a></th>
                <th><a href="{{url_for('deals_bp.deals', prev_sort=prev_sort, order=order, sort='owner', page=page, filter=filter, error='None')}}">Deal Owner</a></th>
                <th><a href="{{url_for('deals_bp.deals', prev_sort=prev_sort, order=order, sort='amount', page=page, filter=filter, error='None')}}">Closed Amount</a></th>
                <th><a href="{{url_for('deals_bp.deals', prev_sort=prev_sort, order=order, sort='goal', page=page, filter=filter, error='None')}}">Goal</a></th>
                <th><a href="{{url_for('deals_bp.deals', prev_sort=prev_sort, order=order, sort='associated_contact', page=page, filter=filter, error='None')}}">Associated Contacts</a></th>
                <th><a href="{{url_for('deals_bp.deals', prev_sort=prev_sort, order=order, sort='associated_company', page=page, filter=filter, error='None')}}">associated_company</a></th>
                <th>Edit Deal</th>
           </tr>
        </thread>
        <tbody>
            {% for form in forms %}
                <tr>
                    <form action="{{url_for('deals_bp.edit_deal', deal_id=form.deal_id.data, filter=filter, prev_sort=prev_sort, sort=sort, page=page, order=order, error=error)}}" method = "POST">
                        {{form.hidden_tag()}}

                        <td>{{form.name()}}
                            {% for error in form.name.errors %}
                                <div>{{ error }}</div>
                            {% endfor %}
                        </td>

                        <td>{{form.stage()}}
                            {% for error in form.stage.errors %}
                                <div>{{ error }}</div>
                            {% endfor %}
                        </td>

                        <td>{{form.date()}}</td>
                        <td>{{form.owner()}}</td>
                        <td>{{form.amount()}}</td>
                        <td>{{form.goal()}}</td>
                        <td>{{form.associated_contact()}}</td>
                        <td>{{form.associated_company()}}</td>
                        <td>{{form.submit(value = "Edit Deal")}}</td>
                    </form>
                </tr>
            {% endfor %}

            <tr>

               <form action = "{{url_for('deals_bp.add_deal', filter=filter, prev_sort=prev_sort, sort=sort, page=page, order=order, error=error)}}" method="POST">
                    {{add_deal.hidden_tag()}}

                    <td>{{add_deal.name()}}
                        {% for error in add_deal.name.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </td>

                    <td>{{add_deal.stage()}}
                        {% for error in add_deal.stage.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </td>

                    <td>{{add_deal.date()}}</td>
                    <td>{{add_deal.owner()}}</td>
                    <td>{{add_deal.amount()}}</td>
                    <td>{{add_deal.goal()}}</td>
                    <td>{{add_deal.associated_contact()}}</td>
                    <td>{{add_deal.associated_company()}}</td>
                    <td>{{add_deal.submit(value="Add Deal")}}</td>
                </form>
            </tr>
        </table>
    </section>

    <section id="errors">
        {% if error != 'None' %} 
            <p>{{error}}</p>
        {% endif %}
    </section>
</div>
</div>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
{% endblock %}